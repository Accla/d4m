<html>
<head>
<title>Cloudbase Documentation : Aggregation</title>
</head>
<body>

<h1>Cloudbase Documentation</h1>

<h2>Aggregation</h2>

<p>Cloudbase does aggregation differently than traditional RDBMSs.  Instead of aggregating at query time, it aggregates at ingest time.  Doing aggregation at ingest time is ideal for large amounts of data and has three distinct advantages.  First, it reduces the actual amount of data stored.  Second, it makes queries run faster.  Third, it removes the need to do a lookup at insert time in many cases, which can greatly speed up ingest. 

<p>Aggregation in cloudbase is easy to use.  You simply specify which columns or column family you want to aggregate at table creation time.  Allowing an aggregation function to apply to a whole column family is an interesting twist that gives the user great flexibility.  The example below demonstrates this flexibility.  

<p><code><pre>
  CBShell v0.1337 - type 'help' for a list of available commands
  &gt; createtable perDayCounts AGG day cloudbase.core.aggregation.StringSummation
  perDayCounts&gt; insert foo day:20080101 1
  perDayCounts&gt; insert foo day:20080101 1
  perDayCounts&gt; insert foo day:20080103 1        
  perDayCounts&gt; insert bar day:20080101 1
  perDayCounts&gt; insert bar day:20080101 1
  perDayCounts&gt; scan
  bar day:20080101 CNF[]  2
  foo day:20080101 CNF[]  2
  foo day:20080103 CNF[]  1
  perDayCounts&gt; 
</pre></code>


<p>Implementing a new aggregation function is a snap.  Simply write some Java code that implements <a href=../src/cloudbase/core/aggregation/Aggregator.java>cloudbase.core.aggregation.Aggregator</a>. A good example to look at is <a href=../src/cloudbase/core/aggregation/StringSummation.java>StringSummation</a> which sums numbers encoded as ascii strings.  However, one could easily write a much more efficient summation aggregator that operates on numbers encoded in twos complement.     

<p>To deploy a new aggregator, jar it up and put the jar in cloudbase/lib/ext.  To see an example look at <a href=../examples/aggregation/>examples/aggregation/</a>

<p>If you would like to see what aggregators a table has you can use the config command like in the following example.

<p><code><pre>
  perDayCounts&gt; config -t perDayCounts cloudbase.table.aggregator
  TYPE       | NAME                                                         | VALUE
  -----------+--------------------------------------------------------------+---------------------
  table      | cloudbase.table.aggregator.day                               | cloudbase.core.aggregation.StringSummation
</pre></code>

<p>You can add aggregators to an existing table using the following command in the cloudbase shell.

<p><code><pre>
  config -t &lt;table name&gt; cloudbase.table.aggregator.&lt;columnFamily[:columnQual]&gt;=&lt;aggregation class&gt;                        
</pre></code>

</body>
</html>